<div class="detail">
  <div class="wrapper">
    <div class="subject">
      <h1></h1>
    </div>
    <div class="email-info flex justify-space-between align-center">
      <div class="contact">
        <p>From: <span class="sender"></span></p>
        <p>To: <span class="recipient"></span></p>
      </div>
      <div class="time">
        <p class="date"></p>
      </div>
    </div>
    <div class="body">
      <p></p>
    </div>
    <div class="attachment-section" style="display: none">
      <hr />
      <p>Attachment: <a href="#" class="attachment-link"></a></p>
    </div>
  </div>
</div>

<script>
  const id = window.location.pathname.split("/")[2];
  const subject = document.querySelector(".subject h1");
  const sender = document.querySelector(".sender");
  const recipient = document.querySelector(".recipient");
  const body = document.querySelector(".body>p");
  const date = document.querySelector(".date");
  const attachmentSection = document.querySelector(".attachment-section");
  const attachmentLink = document.querySelector(".attachment-link");

  fetch(`/get/email-detail/${id}`)
    .then((res) => {
      if (!res.ok) {
        throw new Error("Email not found");
      }
      return res.json();
    })
    .then((data) => {
      // Set email subject
      subject.innerHTML = data.subject;

      // Set sender and recipient
      sender.innerHTML = `${data.senderName} (${data.sender})`;
      recipient.innerHTML = `${data.recipientName} (${data.recipient})`;

      // Format and set date
      const emailDate = new Date(data.sent_at);
      date.innerHTML = emailDate.toLocaleString("en-US", {
        month: "short",
        day: "2-digit",
        year: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        hour12: true,
      });

      // Set email body
      body.innerHTML = data.body || "<em>No content</em>";

      // Handle attachment if present
      if (data.attachment) {
        attachmentSection.style.display = "block";
        attachmentLink.href = `/download/${id}`;
        attachmentLink.innerHTML =
          data.attachment_name || "Download attachment";
      }
    })
    .catch((error) => {
      console.error("Error:", error);
      subject.innerHTML = "Error loading email";
      body.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
    });
</script>

<style>
  .detail .wrapper {
    background-color: white;
    padding: 24px;
    width: 80%;
    margin: auto;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .detail .subject {
    padding: 12px 8px;
    border-bottom: 1px solid #eee;
  }

  .detail .subject h1 {
    font-size: 24px;
    font-weight: 600;
    color: #333;
    margin: 0;
  }

  .detail .email-info {
    padding: 16px 8px;
    border-bottom: 1px solid #eee;
  }

  .detail .contact {
    font-weight: 500;
    color: #666;
  }

  .detail .contact p {
    margin: 4px 0;
  }

  .detail .contact span {
    font-size: 14px;
    font-weight: 400;
    color: #333;
  }

  .detail .date {
    font-weight: 400;
    font-size: 14px;
    color: #666;
  }

  .detail .body {
    padding: 20px 8px;
  }

  .detail .body p {
    line-height: 1.6;
    color: #333;
    white-space: pre-wrap;
  }

  .attachment-section {
    padding: 16px 8px;
    margin-top: 16px;
    border-top: 1px solid #eee;
  }

  .attachment-section a {
    color: #0066cc;
    text-decoration: none;
  }

  .attachment-section a:hover {
    text-decoration: underline;
  }

  @media (max-width: 768px) {
    .detail .wrapper {
      width: 95%;
      padding: 16px;
    }

    .detail .subject h1 {
      font-size: 20px;
    }
  }
</style>
